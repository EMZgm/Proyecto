(this["webpackJsonpgestor-gastos-frontend"]=this["webpackJsonpgestor-gastos-frontend"]||[]).push([[0],{11:function(e,t,s){"use strict";s.r(t);var c=s(1),n=s.n(c),a=s(4),i=s.n(a),r=(s(9),s(0));const l="https://proyecto-backend-4nmq.onrender.com";var o=function(e){let{onLoginSuccess:t}=e;const[s,n]=Object(c.useState)(!0),[a,i]=Object(c.useState)(""),[o,d]=Object(c.useState)(""),[j,b]=Object(c.useState)(null);return Object(r.jsx)("div",{className:"auth-container",children:Object(r.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),b(null);const c="".concat(l,s?"/login":"/register");try{const e=await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a,password:o})}),r=await e.json();if(!e.ok)throw new Error(r.error||"Algo sali\xf3 mal");s?t(r.token):(alert("\xa1Registro exitoso! Ahora, por favor inicia sesi\xf3n."),n(!0),i(""),d(""))}catch(r){b(r.message)}},className:"auth-form",children:[Object(r.jsx)("h2",{children:s?"Iniciar Sesi\xf3n":"Registrarse"}),j&&Object(r.jsx)("div",{className:"error-box",children:j}),Object(r.jsxs)("div",{className:"form-group",children:[Object(r.jsx)("label",{children:"Email"}),Object(r.jsx)("input",{type:"email",value:a,onChange:e=>i(e.target.value),placeholder:"tu@email.com",required:!0})]}),Object(r.jsxs)("div",{className:"form-group",children:[Object(r.jsx)("label",{children:"Contrase\xf1a"}),Object(r.jsx)("input",{type:"password",value:o,onChange:e=>d(e.target.value),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",required:!0})]}),Object(r.jsx)("button",{type:"submit",children:s?"Entrar":"Crear Cuenta"}),Object(r.jsx)("p",{className:"auth-toggle",onClick:()=>n(!s),children:s?"\xbfNo tienes cuenta? Reg\xedstrate":"\xbfYa tienes cuenta? Inicia sesi\xf3n"})]})})},d=s(2);const j="https://proyecto-backend-4nmq.onrender.com";var b=function(e){let{token:t,onLogout:s}=e;const[n,a]=Object(c.useState)("dashboard"),[i,l]=Object(c.useState)([]),[o,b]=Object(c.useState)([]),[m,h]=Object(c.useState)([]),[u,O]=Object(c.useState)([]),[x,p]=Object(c.useState)([]),[g,f]=Object(c.useState)({}),[v,N]=Object(c.useState)({}),[y,S]=Object(c.useState)(null),[k,C]=Object(c.useState)({}),[w,E]=Object(c.useState)(""),[_,D]=Object(c.useState)(""),I=Object(c.useRef)(),T=Object(c.useRef)(),G=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const c=Object(d.a)(Object(d.a)({},s.headers),{},{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)});return fetch(e,Object(d.a)(Object(d.a)({},s),{},{headers:c}))},L=()=>{G("".concat(j,"/expenses")).then(e=>e.json()).then(l),G("".concat(j,"/incomes")).then(e=>e.json()).then(b),G("".concat(j,"/categories")).then(e=>e.json()).then(h),G("".concat(j,"/form-fields/expense")).then(e=>e.json()).then(O),G("".concat(j,"/form-fields/income")).then(e=>e.json()).then(p)};Object(c.useEffect)(()=>{t&&L()},[t]);const J=async e=>{const t=e.map(e=>e.id);await G("".concat(j,"/form-fields/reorder"),{method:"PUT",body:JSON.stringify({orderedIds:t})})},F=(e,t,s)=>{const c="expense"===s;let n=[...c?u:x];if(-1===t&&0===e)return;if(1===t&&e===n.length-1)return;const a=n[e];n[e]=n[e+t],n[e+t]=a,c?O(n):p(n),J(n)},P=(e,t)=>{e.target.classList.remove("dragging-item"),(e=>{const t="expense"===e;let s=[...t?u:x];const c=s.splice(I.current,1)[0];s.splice(T.current,0,c),I.current=null,T.current=null,t?O(s):p(s),J(s)})(t)},B=(e,t)=>{const s=Object(d.a)(Object(d.a)({},e),e.custom_data||{});S(Object(d.a)(Object(d.a)({},s),{},{type:t})),C(s)},R=(e,t)=>{const{name:s,value:c}=e.target;"expense"===t?f(Object(d.a)(Object(d.a)({},g),{},{[s]:c})):N(Object(d.a)(Object(d.a)({},v),{},{[s]:c}))},q=async(e,t)=>{e.preventDefault();const s="".concat(j,"expense"===t?"/expenses":"/incomes"),c="expense"===t?g:v;(await G(s,{method:"POST",body:JSON.stringify(c)})).ok?("expense"===t?f({}):N({}),L()):alert("Error al guardar.")},A=async(e,t)=>{window.confirm("\xbfBorrar elemento?")&&(await G("".concat(j,"/").concat(e,"/").concat(t),{method:"DELETE"}),L())},$=async e=>{e.preventDefault(),_&&(await G("".concat(j,"/categories"),{method:"POST",body:JSON.stringify({name:_})}),D(""),L())},z=[...new Set(["Varios",...m.map(e=>e.name)])],M=o.reduce((e,t)=>e+parseFloat(t.amount),0),U=i.reduce((e,t)=>e+parseFloat(t.amount),0),V=(e,t,s,c)=>Object(r.jsx)(r.Fragment,{children:e.map(e=>Object(r.jsxs)("div",{className:"form-group",children:[Object(r.jsx)("label",{children:e.label}),"select"===e.type?Object(r.jsxs)("select",{name:e.field_key,value:s[e.field_key]||"",onChange:e=>c(e,t),children:[Object(r.jsx)("option",{value:"",children:"Seleccione..."}),z.map(e=>Object(r.jsx)("option",{value:e,children:e},e))]}):Object(r.jsx)("input",{type:"amount"===e.field_key?"number":"text",step:"amount"===e.field_key?"0.01":void 0,name:e.field_key,value:s[e.field_key]||"",onChange:e=>c(e,t),placeholder:e.label,className:e.is_core?"":"dynamic-input"})]},e.id))}),W=(e,t)=>{const s=Object(d.a)(Object(d.a)({},e),e.custom_data),c="expense"===t?u:x;return Object(r.jsx)("div",{className:"item-details",children:c.map(e=>{const t=s[e.field_key];return t?Object(r.jsxs)("div",{className:"field-row",children:[Object(r.jsxs)("span",{className:"field-label",children:[e.label,":"]}),Object(r.jsx)("span",{className:"field-value",children:t})]},e.id):null})})};if(n.startsWith("settings_")){const e="settings_expense"===n,t=e?"expense":"income",s=e?u:x;return Object(r.jsxs)("div",{className:"content settings-view",children:[Object(r.jsxs)("header",{className:"settings-header",children:[Object(r.jsx)("button",{onClick:()=>a("dashboard"),className:"back-btn",children:"\u2b05 Volver"}),Object(r.jsxs)("h2",{children:["\u2699\ufe0f Configuraci\xf3n ",e?"Gastos":"Ingresos"]})]}),Object(r.jsxs)("div",{className:"settings-grid",children:[Object(r.jsxs)("div",{className:"settings-card",children:[Object(r.jsx)("h3",{children:"Orden de Campos"}),Object(r.jsx)("ul",{className:"sortable-list",children:s.map((e,c)=>Object(r.jsxs)("li",{draggable:!0,onDragStart:e=>((e,t)=>{I.current=t,e.target.classList.add("dragging-item")})(e,c),onDragEnter:e=>T.current=c,onDragEnd:e=>P(e,t),onDragOver:e=>e.preventDefault(),className:"draggable-item",children:[Object(r.jsx)("div",{className:"drag-handle",children:"\u2630"}),Object(r.jsxs)("div",{className:"field-info",children:[Object(r.jsx)("strong",{children:e.label}),e.is_core&&Object(r.jsx)("small",{children:"(Default)"})]}),Object(r.jsxs)("div",{className:"field-actions",children:[Object(r.jsxs)("div",{className:"arrow-controls",children:[Object(r.jsx)("button",{onClick:()=>F(c,-1,t),disabled:0===c,children:"\u25b2"}),Object(r.jsx)("button",{onClick:()=>F(c,1,t),disabled:c===s.length-1,children:"\u25bc"})]}),"amount"!==e.field_key?Object(r.jsx)("button",{onClick:()=>(async e=>{window.confirm("\xbfOcultar/Eliminar campo?")&&(await G("".concat(j,"/form-fields/").concat(e),{method:"DELETE"}),L())})(e.id),className:"delete-btn",children:"\xd7"}):Object(r.jsx)("span",{style:{opacity:.3,padding:"0 10px"},children:"\ud83d\udd12"})]})]},e.id))}),Object(r.jsxs)("div",{className:"mini-form",style:{marginTop:20},children:[Object(r.jsx)("input",{value:w,onChange:e=>E(e.target.value),placeholder:"Nuevo Campo..."}),Object(r.jsx)("button",{onClick:()=>(async e=>{w&&(await G("".concat(j,"/form-fields"),{method:"POST",body:JSON.stringify({context:e,label:w,type:"text"})}),E(""),L())})(t),children:"+"})]})]}),e&&s.find(e=>"category"===e.field_key)&&Object(r.jsxs)("div",{className:"settings-card",children:[Object(r.jsx)("h3",{children:"Categor\xedas"}),Object(r.jsx)("ul",{children:m.map(e=>Object(r.jsxs)("li",{children:[e.name," ",Object(r.jsx)("button",{onClick:()=>(async e=>{window.confirm("\xbfBorrar categor\xeda?")&&(await G("".concat(j,"/categories/").concat(e),{method:"DELETE"}),L())})(e.id),className:"delete-btn",children:"\xd7"})]},e.id))}),Object(r.jsxs)("form",{onSubmit:$,className:"mini-form",children:[Object(r.jsx)("input",{value:_,onChange:e=>D(e.target.value),placeholder:"Nueva..."}),Object(r.jsx)("button",{type:"submit",children:"+"})]})]})]})]})}return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsxs)("header",{children:[Object(r.jsx)("h1",{children:"Mi Gestor \ud83d\udcb8"}),Object(r.jsx)("button",{onClick:s,className:"logout-btn",children:"Cerrar Sesi\xf3n"})]}),Object(r.jsxs)("div",{className:"balance-bar",children:[Object(r.jsxs)("div",{className:"balance-card income",children:[Object(r.jsx)("span",{children:"Ingresos"}),Object(r.jsxs)("span",{children:["+$",M.toFixed(2)]})]}),Object(r.jsxs)("div",{className:"balance-card expense",children:[Object(r.jsx)("span",{children:"Gastos"}),Object(r.jsxs)("span",{children:["-$",U.toFixed(2)]})]}),Object(r.jsxs)("div",{className:"balance-card balance",children:[Object(r.jsx)("span",{children:"Balance"}),Object(r.jsxs)("span",{style:{color:M-U>=0?"#27ae60":"#c0392b"},children:["$",(M-U).toFixed(2)]})]})]}),Object(r.jsxs)("div",{className:"content",children:[Object(r.jsxs)("div",{className:"forms-column",children:[Object(r.jsxs)("form",{onSubmit:e=>q(e,"income"),className:"income-form",children:[Object(r.jsxs)("div",{className:"form-header",children:[Object(r.jsx)("h2",{children:"A\xf1adir Ingreso"}),Object(r.jsx)("button",{type:"button",className:"gear-btn",onClick:()=>a("settings_income"),children:"\u2699\ufe0f"})]}),V(x,"income",v,R),Object(r.jsx)("button",{type:"submit",children:"Guardar"})]}),Object(r.jsxs)("form",{onSubmit:e=>q(e,"expense"),className:"expense-form",children:[Object(r.jsxs)("div",{className:"form-header",children:[Object(r.jsx)("h2",{children:"Nuevo Gasto"}),Object(r.jsx)("button",{type:"button",className:"gear-btn",onClick:()=>a("settings_expense"),children:"\u2699\ufe0f"})]}),V(u,"expense",g,R),Object(r.jsx)("button",{type:"submit",children:"Guardar"})]})]}),Object(r.jsxs)("div",{className:"lists-column",children:[Object(r.jsxs)("div",{className:"income-list",children:[Object(r.jsx)("h3",{children:"Ingresos"}),o.map(e=>Object(r.jsxs)("article",{className:"income-card",children:[W(e,"income"),Object(r.jsxs)("div",{className:"card-actions",children:[Object(r.jsx)("button",{onClick:()=>B(e,"income"),className:"edit-btn",children:"\u270f\ufe0f"}),Object(r.jsx)("button",{onClick:()=>A("incomes",e.id),className:"delete-btn",children:"\xd7"})]})]},e.id))]}),Object(r.jsxs)("div",{className:"expense-list",children:[Object(r.jsx)("h3",{children:"Gastos"}),i.map(e=>Object(r.jsxs)("article",{className:"expense-card",children:[W(e,"expense"),Object(r.jsxs)("div",{className:"card-actions",children:[Object(r.jsx)("button",{onClick:()=>B(e,"expense"),className:"edit-btn",children:"\u270f\ufe0f"}),Object(r.jsx)("button",{onClick:()=>A("expenses",e.id),className:"delete-btn",children:"\xd7"})]})]},e.id))]})]})]}),y&&Object(r.jsx)("div",{className:"modal-overlay",children:Object(r.jsxs)("div",{className:"modal-content",children:[Object(r.jsxs)("h2",{children:["Editar ","expense"===y.type?"Gasto":"Ingreso"]}),Object(r.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),!y)return;const t="expense"===y.type?"".concat(j,"/expenses/").concat(y.id):"".concat(j,"/incomes/").concat(y.id);(await G(t,{method:"PUT",body:JSON.stringify(k)})).ok?(S(null),L()):alert("Error al actualizar.")},children:[V("expense"===y.type?u:x,y.type,k,e=>{C(Object(d.a)(Object(d.a)({},k),{},{[e.target.name]:e.target.value}))}),Object(r.jsxs)("div",{className:"modal-buttons",children:[Object(r.jsx)("button",{type:"button",onClick:()=>S(null),className:"cancel-btn",children:"Cancelar"}),Object(r.jsx)("button",{type:"submit",className:"save-btn",children:"Guardar Cambios"})]})]})]})})]})};var m=function(){const[e,t]=Object(c.useState)(localStorage.getItem("token"));return Object(c.useEffect)(()=>{e?localStorage.setItem("token",e):localStorage.removeItem("token")},[e]),Object(r.jsx)("div",{className:"container",children:e?Object(r.jsx)(b,{token:e,onLogout:()=>{t(null)}}):Object(r.jsx)(o,{onLoginSuccess:t})})};i.a.render(Object(r.jsx)(n.a.StrictMode,{children:Object(r.jsx)(m,{})}),document.getElementById("root"))},9:function(e,t,s){}},[[11,1,2]]]);
//# sourceMappingURL=main.fae24647.chunk.js.map